---
title: Kafka
author: seungbin
date: 2025-02-12 00:00
categories: [STACK, Kafka]
tags: [devops]
pin: true
math: true
mermaid: true
---
Kafka란 오픈 소스 분산 이벤트 스트리밍 플랫폼을 말한다.
## **Kafka는 왜 생겼을까?**
{: .mt-4 .mb-2}
kafka는 linkedin에서 개발되었는데 linkedIn에서는 대규모의 사용자 활동, 로그, 메시지 등의 이벤트 데이터를 실시간으로 수집, 분석이 필요했다.<br>
하지만 기존의 MQ, DB 기반의 솔루션으로는 높은 트래픽을 처리하기가 어렵고 확장성이 부족했고 그로 인해 Kafka가 탄생하게 되었다.

## **Kafka의 사용 이유는?**
{: .mt-4 .mb-0}

##### **Kafka는 실시간 대용량 처리에 강하다.**
{: .mt-3 .mb-2}
카프카는 초당 수백만개의 메시지를 처리(수집, 저장, 전달) 할 수 있도록 설계되었다.

##### **Kafka는 Pub/Sub 모델을 사용하여 여러개의 시스템이 같은 데이터를 동시에 받을 수 있다.**
{: .mt-3 .mb-2}

##### **Kafka는 분산 아키텍쳐를 사용하여 아래와 같은 장점을 가진다.**
{: .mt-3 .mb-2}
- 수평적 확장 : Kafka는 노드를 추가하는 방식으로 쉽게 확장이 가능하다.
- 고가용성 : Kafka의 데이터는 여러개의 브로커에 복제 되어있어서 하나가 죽어도 다른 노드가 데이터를 보존하고 있다. 
- 부하 분산 : 데이터가 여러 개의 파티션으로 분산 저장되어 한개의 노드에 모든 데이터가 몰리지 않는다.

##### **Kafka는 데이터 영속성, 안정성이 좋다.**
{: .mt-3 .mb-2}
- Kafka는 데이터를 디스크에 로그 형식으로 저장하여 메모리에만 의존하는 시스템보다 훨씬 안정적이다.
- 장애가 발생해도 카프카는 데이터를 보존하고, 소비자는 중단된 위치부터 다시 읽을 수 있다.
- 데이터가 손실되지 않도록 Replication Factor를 설정할 수 있다.

##### **⇒  결론은 카프카는 실시간으로 많은 양의 데이터를 안정적으로 처리(수집, 적재, 전달)하기 위해서 사용한다.(카프카에서 말하는 데이터 처리란 데이터를 빠르게 수신하고 전달하는 것을 의미한다.)**
{: .mt-3 .mb-2}

## **Kafka 개념**
{: .mt-4 .mb-2}

##### **토픽**
{: .mt-3 .mb-2}
카프카에서 토픽은 같은 목적의 메시지를 그룹화하는 논리적 개념이고.<br>
실제로 각 토픽에 해당하는 메시지들은 파티션에 저장된다.

##### **파티션**
{: .mt-3 .mb-2}
카프카는 하나의 토픽의 메시지에 대한 처리량을 높이기 위해 토픽의 메시지를  여러 대의 노드(브로커)에 나눠서 저장하고 이를 파티셔닝이라고 한다.<br>
한 토픽으로 삽입되는 메시지들은 각 파티션으로 나뉘어서 저장된다.<br>
카프카가 3개의 노드로 구성되어있고 한 토픽에 대한 파티션을 3으로 설정했다면 각 노드에 해당 토픽에 대한 파티션이 하나씩 생성된다.<br>
파티션은 수평 확장이 가능하다.<br>
파티션은 각 카프카 브로커의 디렉토리와 매핑되고 저장되는 데이터마다 2개의 데이터가 저장된다.

##### **레플리케이션**
{: .mt-3 .mb-2}
카프카는 클러스터를 구성하는 노드들에 파티션을 복제하여 저장한다.<br>
3개의 노드로 카프카 클러스터가 구성되어있고 A토픽이 3개의 파티셔닝이 되어있고 replication이 2이면
A토픽에 대한 파티션이 다음과 같이 존재한다.
- node 1 : partition 0(leader), partition 2(follower)
- node 2 : partition 1(leader), partition 0(follower)
- node 3 : partition 2(leader), partition 1(follower)

이해를 돕기 위한 다른 예시의 그림<br>
![Desktop View](/assets/img/postImage/kafkaReflication.png)
(이미지 출처 : https://blog.ippon.tech/event-driven-architecture-getting-started-with-kafka-part-2)




